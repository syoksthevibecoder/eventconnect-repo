{% extends 'base.html' %}

{% block title %}Get Tickets for {{ event.title }} - EventConnect254{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card shadow">
                <div class="card-body p-4">
                    <h1 class="h3 mb-4 fw-bold">Get Tickets</h1>
                    
                    <!-- Event Summary -->
                    <div class="card bg-light mb-4">
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-3">
                                    {% if event.image %}
                                        <img src="{{ event.image.url }}" class="img-fluid rounded" alt="{{ event.title }}">
                                    {% else %}
                                        <img src="https://via.placeholder.com/150?text=No+Image" class="img-fluid rounded" alt="No image">
                                    {% endif %}
                                </div>
                                <div class="col-md-9">
                                    <h4 class="mb-1">{{ event.title }}</h4>
                                    <p class="text-muted mb-2">
                                        <i class="far fa-calendar-alt me-1"></i> {{ event.start_date|date:"F d, Y" }}
                                        <span class="mx-2">|</span>
                                        <i class="far fa-clock me-1"></i> {{ event.start_date|date:"g:i A" }}
                                    </p>
                                    <p class="mb-0">
                                        <i class="fas fa-map-marker-alt me-1"></i> {{ event.venue }}, {{ event.location }}
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Simplified Ticket Form -->
                    <form method="post" id="ticket-form">
                        {% csrf_token %}
                        
                        <h4 class="h5 mb-3">Ticket Information</h4>
                        <div class="mb-4">
                            {% for ticket in available_tickets %}
                                <div class="form-check mb-3">
                                    <input class="form-check-input" type="radio" name="ticket" 
                                           id="ticket{{ ticket.id }}" value="{{ ticket.id }}"
                                           {% if forloop.first %}checked{% endif %}>
                                    <label class="form-check-label" for="ticket{{ ticket.id }}">
                                        <div class="d-flex justify-content-between">
                                            <span>{{ ticket.get_ticket_type_display }}</span>
                                            <span class="fw-bold">${{ ticket.price }}</span>
                                        </div>
                                    </label>
                                </div>
                            {% endfor %}
                            
                            <div class="mb-4">
                                <label for="quantity" class="form-label">Number of Tickets</label>
                                <select class="form-select" id="quantity" name="quantity">
                                    {% for i in '12345'|make_list %}
                                        <option value="{{ i }}">{{ i }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                        
                        <hr class="my-4">
                        
                        <!-- Order Summary -->
                        <h4 class="h5 mb-3">Order Summary</h4>
                        <div class="card bg-light mb-4">
                            <div class="card-body">
                                <div class="d-flex justify-content-between mb-2">
                                    <span>Ticket Price</span>
                                    <span class="ticket-price fw-bold">$0.00</span>
                                </div>
                                <div class="d-flex justify-content-between mb-2">
                                    <span>Quantity</span>
                                    <span class="ticket-quantity">1</span>
                                </div>
                                <hr>
                                <div class="d-flex justify-content-between fw-bold">
                                    <span>Total</span>
                                    <span class="order-total">$0.00</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-check mb-4">
                            <input class="form-check-input" type="checkbox" id="terms" required>
                            <label class="form-check-label" for="terms">
                                I agree to the <a href="#">Terms and Conditions</a>
                            </label>
                        </div>
                        
                        <div class="d-grid">
                            <button class="btn btn-primary btn-lg" type="submit">Get Tickets</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Elements for updating the order summary
        const ticketOptions = document.querySelectorAll('input[name="ticket"]');
        const quantitySelect = document.getElementById('quantity');
        const ticketPriceElement = document.querySelector('.ticket-price');
        const ticketQuantityElement = document.querySelector('.ticket-quantity');
        const orderTotalElement = document.querySelector('.order-total');
        
        // Function to update the order summary
        function updateOrderSummary() {
            const selectedTicket = document.querySelector('input[name="ticket"]:checked');
            const ticketLabel = selectedTicket.nextElementSibling;
            const priceText = ticketLabel.querySelector('.fw-bold') ? 
                              ticketLabel.querySelector('.fw-bold').textContent : 
                              ticketLabel.textContent.split('$')[1];
            
            const ticketPrice = parseFloat(priceText.replace('$', ''));
            const quantity = parseInt(quantitySelect.value);
            
            // Update the summary elements
            ticketPriceElement.textContent = `$${ticketPrice.toFixed(2)}`;
            ticketQuantityElement.textContent = quantity;
            
            // Calculate total
            const total = ticketPrice * quantity;
            orderTotalElement.textContent = `$${total.toFixed(2)}`;
        }
        
        // Add event listeners
        ticketOptions.forEach(option => {
            option.addEventListener('change', updateOrderSummary);
        });
        
        quantitySelect.addEventListener('change', updateOrderSummary);
        
        // Initialize order summary
        updateOrderSummary();
    });
</script>
{% endblock %}
{% endblock %}